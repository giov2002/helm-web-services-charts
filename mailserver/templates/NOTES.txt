🚀 Mailstack déployé avec succès!

📧 Configuration de votre serveur de messagerie:
--------------------------------------------------

📍 Namespace: {{ .Values.global.namespace }}
🌐 Domaine: {{ .Values.global.domain }}

📦 Services déployés:
--------------------------------------------------

{{- if .Values.mailserver.enabled }}
✅ Serveur Mail (docker-mailserver):
   - Répliques: {{ .Values.mailserver.replicaCount }}
   - Ports:
     * SMTP: {{ .Values.mailserver.ports.smtp }}
     * IMAP: {{ .Values.mailserver.ports.imap }}
     * Submission: {{ .Values.mailserver.ports.submission }}
     * IMAPS: {{ .Values.mailserver.ports.imaps }}
     * SMTPS: {{ .Values.mailserver.ports.smtps }}

📧 Comptes email configurés:
{{- range .Values.mailserver.accounts }}
   - {{ .email }}
{{- end }}

{{- if .Values.mailserver.aliases }}
📧 Alias configurés:
{{- range .Values.mailserver.aliases }}
   - {{ .alias }} → {{ .target }}
{{- end }}
{{- end }}
{{- end }}

{{- if .Values.roundcube.enabled }}
{{- if .Values.roundcube.instance1.enabled }}
✅ Roundcube Instance 1:
   - Service: {{ .Values.roundcube.instance1.name }}
   - Répliques: {{ .Values.roundcube.instance1.replicaCount }}
   {{- if eq .Values.roundcube.instance1.service.type "NodePort" }}
   - URL: http://<NODE-IP>:{{ .Values.roundcube.instance1.service.nodePort }}
   {{- else }}
   - Port: {{ .Values.roundcube.instance1.service.port }}
   {{- end }}
{{- end }}

{{- if .Values.roundcube.instance2.enabled }}
✅ Roundcube Instance 2:
   - Service: {{ .Values.roundcube.instance2.name }}
   - Répliques: {{ .Values.roundcube.instance2.replicaCount }}
   {{- if eq .Values.roundcube.instance2.service.type "NodePort" }}
   - URL: http://<NODE-IP>:{{ .Values.roundcube.instance2.service.nodePort }}
   {{- else }}
   - Port: {{ .Values.roundcube.instance2.service.port }}
   {{- end }}
{{- end }}
{{- end }}

🔧 Commandes utiles:
--------------------------------------------------

1. Vérifier le statut des pods:
   kubectl get pods -n {{ .Values.global.namespace }}

2. Voir les logs du serveur mail:
   kubectl logs -n {{ .Values.global.namespace }} deployment/mailserver

3. Voir les logs de Roundcube:
   {{- if .Values.roundcube.instance1.enabled }}
   kubectl logs -n {{ .Values.global.namespace }} deployment/{{ .Values.roundcube.instance1.name }}
   {{- end }}
   {{- if .Values.roundcube.instance2.enabled }}
   kubectl logs -n {{ .Values.global.namespace }} deployment/{{ .Values.roundcube.instance2.name }}
   {{- end }}

4. Accéder au shell du serveur mail:
   kubectl exec -it -n {{ .Values.global.namespace }} deployment/mailserver -- /bin/bash

5. Vérifier les services:
   kubectl get svc -n {{ .Values.global.namespace }}

6. Vérifier les PVCs:
   kubectl get pvc -n {{ .Values.global.namespace }}

🌐 Accès aux services:
--------------------------------------------------

{{- if .Values.roundcube.enabled }}
{{- if .Values.roundcube.instance1.enabled }}
{{- if eq .Values.roundcube.instance1.service.type "NodePort" }}
• Roundcube Instance 1: http://<NODE-IP>:{{ .Values.roundcube.instance1.service.nodePort }}
{{- else }}
• Roundcube Instance 1: Port-forward avec: kubectl port-forward -n {{ .Values.global.namespace }} svc/{{ .Values.roundcube.instance1.name }} 8080:80
  Puis accès via: http://localhost:8080
{{- end }}
{{- end }}

{{- if .Values.roundcube.instance2.enabled }}
{{- if eq .Values.roundcube.instance2.service.type "NodePort" }}
• Roundcube Instance 2: http://<NODE-IP>:{{ .Values.roundcube.instance2.service.nodePort }}
{{- else }}
• Roundcube Instance 2: Port-forward avec: kubectl port-forward -n {{ .Values.global.namespace }} svc/{{ .Values.roundcube.instance2.name }} 8081:80
  Puis accès via: http://localhost:8081
{{- end }}
{{- end }}
{{- end }}

📝 Configuration client email (IMAP/SMTP):
--------------------------------------------------
• Serveur IMAP: mailserver.{{ .Values.global.namespace }}.svc.cluster.local:{{ .Values.mailserver.ports.imap }}
• Serveur SMTP: mailserver.{{ .Values.global.namespace }}.svc.cluster.local:{{ .Values.mailserver.ports.submission }}

⚠️  Note importante:
--------------------------------------------------
• Le serveur mail utilise des certificats auto-signés par défaut
• Pour la production, configurez des certificats SSL valides
• Assurez-vous que les ports nécessaires sont ouverts sur votre cluster

🔍 Dépannage:
--------------------------------------------------
En cas de problème, vérifiez:
1. Les logs des pods
2. Les événements: kubectl get events -n {{ .Values.global.namespace }}
3. La connectivité réseau entre les services
4. Les volumes persistants

📚 Documentation:
--------------------------------------------------
• docker-mailserver: https://docker-mailserver.github.io/docker-mailserver/latest/
• Roundcube: https://roundcube.net/

Bon usage de votre serveur de messagerie! 📬
