{{- if .Values.mailserver.enabled }}
{{- if .Values.mailserver.persistence.enabled }}
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mailserver-data
  namespace: {{ .Values.global.namespace }}
  labels:
    {{- include "mailstack.mailserver.labels" . | nindent 4 }}
    component: data
    {{- with .Values.commonLabels }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
  {{- with .Values.commonAnnotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: {{ .Values.mailserver.persistence.size }}
  {{- if .Values.mailserver.persistence.storageClass }}
  storageClassName: {{ .Values.mailserver.persistence.storageClass }}
  {{- end }}

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mailserver-state
  namespace: {{ .Values.global.namespace }}
  labels:
    {{- include "mailstack.mailserver.labels" . | nindent 4 }}
    component: state
    {{- with .Values.commonLabels }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
  {{- with .Values.commonAnnotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 2Gi
  {{- if .Values.mailserver.persistence.storageClass }}
  storageClassName: {{ .Values.mailserver.persistence.storageClass }}
  {{- end }}

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mailserver-logs
  namespace: {{ .Values.global.namespace }}
  labels:
    {{- include "mailstack.mailserver.labels" . | nindent 4 }}
    component: logs
    {{- with .Values.commonLabels }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
  {{- with .Values.commonAnnotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi
  {{- if .Values.mailserver.persistence.storageClass }}
  storageClassName: {{ .Values.mailserver.persistence.storageClass }}
  {{- end }}

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: mailserver-config
  namespace: {{ .Values.global.namespace }}
  labels:
    {{- include "mailstack.mailserver.labels" . | nindent 4 }}
    component: config
    {{- with .Values.commonLabels }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
  {{- with .Values.commonAnnotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 1Gi
  {{- if .Values.mailserver.persistence.storageClass }}
  storageClassName: {{ .Values.mailserver.persistence.storageClass }}
  {{- end }}
{{- end }}
{{- end }}

{{- if .Values.roundcube.enabled }}
{{- if and .Values.roundcube.instance1.enabled .Values.roundcube.instance1.persistence.enabled }}
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: {{ .Values.roundcube.instance1.name }}-data
  namespace: {{ .Values.global.namespace }}
  labels:
    {{- include "mailstack.roundcube.labels" . | nindent 4 }}
    app: {{ .Values.roundcube.instance1.name }}
    component: data
    {{- with .Values.commonLabels }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
  {{- with .Values.commonAnnotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: {{ .Values.roundcube.instance1.persistence.size }}
  {{- if .Values.roundcube.instance1.persistence.storageClass }}
  storageClassName: {{ .Values.roundcube.instance1.persistence.storageClass }}
  {{- end }}
{{- end }}

{{- if and .Values.roundcube.instance2.enabled .Values.roundcube.instance2.persistence.enabled }}
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: {{ .Values.roundcube.instance2.name }}-data
  namespace: {{ .Values.global.namespace }}
  labels:
    {{- include "mailstack.roundcube.labels" . | nindent 4 }}
    app: {{ .Values.roundcube.instance2.name }}
    component: data
    {{- with .Values.commonLabels }}
    {{- toYaml . | nindent 4 }}
    {{- end }}
  {{- with .Values.commonAnnotations }}
  annotations:
    {{- toYaml . | nindent 4 }}
  {{- end }}
spec:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: {{ .Values.roundcube.instance2.persistence.size }}
  {{- if .Values.roundcube.instance2.persistence.storageClass }}
  storageClassName: {{ .Values.roundcube.instance2.persistence.storageClass }}
  {{- end }}
{{- end }}
{{- end }}
